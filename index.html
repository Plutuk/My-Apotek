<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>My-Apotek | Smart Rule-Based 2026</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        body { background-color: #f4f7f6; padding-bottom: 50px; }
        .card { border-radius: 15px; margin-top: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .bg-header { background: #1e3c72; color: white; padding: 20px; border-radius: 0 0 20px 20px; }
    </style>
</head>
<body>

<div class="bg-header text-center">
    <h2>Sistem My-Apotek (Remedial 2026)</h2>
    <p>Manajemen Keuangan Riil & Rule Engine Klinis</p>
</div>

<div class="container">
    <div class="row">
        <div class="col-12">
            <div class="card p-3">
                <h5 class="text-primary">ðŸ“¦ Alur 1: Input Barang & Harga Beli</h5>
                <div class="row g-2">
                    <div class="col-md-3"><label class="small fw-bold">Nama Obat</label><input type="text" id="a1_nama" class="form-control" value="Amoxicillin"></div>
                    <div class="col-md-3"><label class="small fw-bold">Supplier</label><input type="text" id="a1_supplier" class="form-control" value="Kimia Farma"></div>
                    <div class="col-md-3"><label class="small fw-bold">Harga Beli Satuan</label><input type="number" id="a1_harga" class="form-control" value="5000"></div>
                    <div class="col-md-3"><label class="small fw-bold">Stok Masuk</label><input type="number" id="a1_qty" class="form-control" value="100"></div>
                </div>
            </div>
        </div>

        <div class="col-md-8">
            <div class="card p-3">
                <h5 class="text-warning">ðŸ“œ Alur 2: Resep & Penjualan Pasien</h5>
                <div class="row g-2">
                    <div class="col-md-6"><label class="small fw-bold">Nama Pasien</label><input type="text" id="a2_nama_p" class="form-control" value="Budianto"></div>
                    <div class="col-md-6"><label class="small fw-bold">NIK</label><input type="text" id="a2_nik" class="form-control" value="1298219"></div>
                    <div class="col-md-4"><label class="small fw-bold">Obat Diresepkan</label><input type="text" id="a2_obat" class="form-control" value="Amoxicillin"></div>
                    <div class="col-md-4"><label class="small fw-bold">Jumlah Beli (Qty)</label><input type="number" id="a2_qty_jual" class="form-control" value="10"></div>
                    <div class="col-md-4">
                        <label class="small fw-bold">Metode Bayar</label>
                        <select id="a2_metode" class="form-select">
                            <option value="Tunai">Tunai (Cash)</option>
                            <option value="Asuransi">Asuransi (Piutang)</option>
                        </select>
                    </div>
                    <div class="col-12 mt-3">
                        <button onclick="cekKlinis()" class="btn btn-warning w-100 fw-bold">Analisis & Hitung Transaksi</button>
                    </div>
                </div>
                <div id="res_alur2" class="mt-2 p-2 text-center rounded fw-bold border">Status: -</div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card p-3">
                <h5 class="text-success">ðŸ“Š Alur 3: Audit Stok</h5>
                <label class="small fw-bold">Stok Sistem</label>
                <input type="number" id="a3_sistem" class="form-control mb-2" value="100">
                <label class="small fw-bold">Stok Fisik</label>
                <input type="number" id="a3_fisik" class="form-control mb-2" value="95">
                <button onclick="cekOpname()" class="btn btn-success w-100">Cek Selisih</button>
                <div id="res_alur3" class="mt-2 small fw-bold text-center"></div>
            </div>
        </div>

        <div class="col-12 mt-4 text-center">
            <button onclick="generateFullReport()" class="btn btn-dark btn-lg px-5">ðŸ“„ CETAK LAPORAN BERDASARKAN TRANSAKSI PASIEN</button>
        </div>
    </div>
</div>

<script>
    function cekKlinis() {
        const res = document.getElementById('res_alur2');
        res.innerHTML = "âœ… RESEP TERVERIFIKASI & HARGA DIHITUNG";
        res.className = "mt-2 p-2 text-center rounded fw-bold border bg-success text-white";
    }

    function cekOpname() {
        const selisih = Math.abs(document.getElementById('a3_sistem').value - document.getElementById('a3_fisik').value);
        document.getElementById('res_alur3').innerHTML = "Selisih: " + selisih + " unit";
    }

    function generateFullReport() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        // Data Riil dari Input
        const hargaBeli = parseFloat(document.getElementById('a1_harga').value) || 0;
        const qtyJual = parseFloat(document.getElementById('a2_qty_jual').value) || 0;
        const metode = document.getElementById('a2_metode').value;
        
        // Kalkulasi: Harga Jual (Margin 30%)
        const hargaJual = hargaBeli * 1.3;
        const totalTransaksi = hargaJual * qtyJual;
        
        let pendapatanTunai = metode === "Tunai" ? totalTransaksi : 0;
        let piutangAsuransi = metode === "Asuransi" ? totalTransaksi : 0;
        const hpp = hargaBeli * qtyJual;

        doc.setFontSize(16);
        doc.text("LAPORAN FINAL MY-APOTEK 2026", 105, 15, { align: "center" });

        // 1. Laporan Keuangan (Berdasarkan Pasien)
        doc.setFontSize(12); doc.text("1. LAPORAN KEUANGAN RIIL", 14, 30);
        doc.autoTable({
            startY: 33,
            head: [['Kategori', 'Nilai (Berdasarkan Transaksi)']],
            body: [
                ['Pendapatan Tunai (Pasien)', 'Rp ' + pendapatanTunai.toLocaleString()],
                ['Piutang (Klaim Asuransi)', 'Rp ' + piutangAsuransi.toLocaleString()],
                ['Total HPP', 'Rp ' + hpp.toLocaleString()],
                ['Margin Keuntungan', '30% (Rp ' + (totalTransaksi - hpp).toLocaleString() + ')'],
                ['Cash Flow', pendapatanTunai > 0 ? 'LANCAR' : 'MENUNGGU KLAIM']
            ],
        });

        // 2. Laporan Barang
        doc.text("2. LAPORAN BARANG", 14, doc.lastAutoTable.finalY + 10);
        doc.autoTable({
            startY: doc.lastAutoTable.finalY + 15,
            head: [['Keterangan', 'Detail']],
            body: [
                ['Supplier Barang', document.getElementById('a1_supplier').value],
                ['Obat Keluar (Pasien)', document.getElementById('a2_obat').value + " (" + qtyJual + " unit)"],
                ['Status Stok', 'Berkurang ' + qtyJual + ' unit']
            ],
        });

        // 3. Laporan Klinis
        doc.text("3. LAPORAN KLINIS", 14, doc.lastAutoTable.finalY + 10);
        doc.autoTable({
            startY: doc.lastAutoTable.finalY + 15,
            head: [['Indikator', 'Hasil Analisis']],
            body: [
                ['Nama Pasien / NIK', document.getElementById('a2_nama_p').value + " / " + document.getElementById('a2_nik').value],
                ['Status Analisis Klinis', 'AMAN (SIAP DISPENSING)']
            ],
        });

        doc.save("Laporan_Riil_MyApotek.pdf");
    }
</script>
</body>
</html>
